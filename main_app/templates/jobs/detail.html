{% extends 'base.html' %}
{% block content %}
<h1>Job Details</h1>
<div class="card">
    <a href="{% url 'detail' job.id %}">
        <div class="card-content">
            <span class="card-title">{{job.company}}</span>
            <p>Job Title: {{job.jobTitle}}</p>
            <p>Description: {{job.description}}</p>
            <p>Salary: {{job.salary}}</p>
            <p>Contact Info: {{job.contactInfo}}</p>
            <div class="card-action">
                <a href='{% url 'jobs_update' job.id %}'>Edit</a>
                <a href='{% url 'jobs_delete' job.id %}'>Delete</a>
            </div>    
        </div>
    </a>
</div>

<form method='post' action="{% url 'add_event' job.id %}">
    {% csrf_token %}
    {{event_form.as_p}}
    <input type='submit' class='btn' value='Add Event'>
</form>

<div>
    <table class='striped'>
        <thead>
            <tr>
                <th>Date</th>
                <th>Type</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            {% for event in job.event_set.all %}
            <tr>
                <td>{{event.date}}</td>
                <td>{{event.get_type_display}}</td>
                <td>{{event.description}}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <div class='row'>
        <div class='col s6'>
            <h3>{{ job.jobTitle }}</h3>
            {% if job.companies.count%}
                {% for company in job.companies.all %}
                <div class='card'>
                    <div class='card-content'>
                        <span class='card-title'>
                            {{company.name}} - {{company.description}}
                        </span>
                        <div class='card-action'>
                            <form action="{% url 'unassoc_company' job.id company.id %}" method='POST'>
                                {% csrf_token %}
                                <button type='submit' class='btn'>Remove</button>
                            </form>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <h5>No company's have postings for this job!</h5>
            {% endif %}
        </div>
        <div class='col s6'>
            <h3>Available Companies</h3>
            {% if companies.count %}
            {% for company in companies.all %}
                <div class='card'>
                    <div class='card-content'>
                        <span class='card-title'>
                            {{company.name}} - {{company.description}}
                        </span>
                    
                        <div class='card-action'>
                            <form action="{% url 'assoc_company' job.id company.id %}" method='POST'>
                                {% csrf_token %}
                                <button type='submit' class='btn'>Add</button>
                            </form>
                        </div>
                    </div>
                </div>
            {% endfor %}
            {% else %}
            <h5>There are {{job.jobTitle}} positions for all companies!</h5>
            {% endif %}
        </div>
    </div>
</div>

<script>
    let dateEl = document.getElementById('id_date');
    M.Datepicker.init(dateEl, {
        format: 'yyyy-mm-dd',
        defaultDate: new Date(),
        setDefaultDate: true,
        autoclose: true,
    })
    let typeEl = document.getElementById('id_type');
    M.FormSelect.init(typeEl);
    </script>
        
{% endblock %}